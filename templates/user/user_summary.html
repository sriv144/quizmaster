{% extends "base.html" %}
{% block title %}My Performance Summary{% endblock %}

{% block additional_css %}
<style>
/* New Summary Page Styles (do not override base.html) */
.dashboard-container {
    max-width: 1200px;
    margin: 20px auto;
    padding: 20px;
    animation: fadeInUp 0.7s ease forwards;
}
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
.dashboard-header {
    text-align: center;
    padding: 20px;
    background: #1e1e1e;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}
.dashboard-header h1 {
    color: #fff;
    font-size: 2.5rem;
    margin: 0;
}
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}
.stat-card {
    background: #1f1f1f;
    border-top: 3px solid #66e6a8;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.stat-card:hover {
    transform: translateY(-5px);
}
.stat-value {
    font-size: 2.4rem;
    font-weight: bold;
    color: #66e6a8;
    margin-bottom: 5px;
}
.stat-label {
    font-size: 1rem;
    color: #b0b0b0;
}
.chart-container {
    background: #1f1f1f;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.chart-title {
    font-size: 1.4rem;
    margin-bottom: 10px;
    color: #fff;
}
.chart-wrapper {
    position: relative;
    height: 350px;
    width: 100%;
}
@media (max-width: 768px) {
    .chart-wrapper { height: 300px; }
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <h1>My Performance Summary</h1>
    </div>
    <!-- Stat Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-value">{{ total_quizzes }}</div>
            <div class="stat-label">Total Quizzes</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ "%.1f"|format(average_score) }}%</div>
            <div class="stat-label">Average Score</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ total_questions_attempted }}</div>
            <div class="stat-label">Questions Attempted</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ total_correct }}</div>
            <div class="stat-label">Questions Correct</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ "%.1f"|format(overall_accuracy) }}%</div>
            <div class="stat-label">Overall Accuracy</div>
        </div>
    </div>
    <!-- Charts -->
    <div class="chart-container">
        <h2 class="chart-title">Performance Over Time</h2>
        <div class="chart-wrapper">
            <canvas id="performanceChart"></canvas>
        </div>
    </div>
    <div class="chart-container">
        <h2 class="chart-title">Time Spent per Quiz</h2>
        <div class="chart-wrapper">
            <canvas id="timeSpentChart"></canvas>
        </div>
    </div>
    <div class="chart-container">
        <h2 class="chart-title">Difficulty Level Analysis</h2>
        <div class="chart-wrapper">
            <canvas id="difficultyChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Load Chart.js first -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Performance Over Time (Line Chart)
    var ctx1 = document.getElementById('performanceChart').getContext('2d');
    new Chart(ctx1, {
        type: 'line',
        data: {
            labels: {{ score_timeline | map(attribute='date') | list | tojson }},
            datasets: [{
                label: 'Score Percentage (%)',
                data: {{ score_timeline | map(attribute='score') | list | tojson }},
                borderColor: '#66e6a8',
                backgroundColor: 'rgba(102,230,168,0.1)',
                fill: true,
                tension: 0.2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    title: { display: true, text: 'Score (%)' },
                    ticks: { color: '#f5f5f5' }
                },
                x: {
                    title: { display: true, text: 'Date' },
                    ticks: { color: '#f5f5f5' }
                }
            },
            plugins: {
                legend: { labels: { color: '#f5f5f5' } },
                tooltip: { backgroundColor: '#333', titleColor: '#fff', bodyColor: '#fff' }
            }
        }
    });

    // Time Spent per Quiz (Bar Chart)
    var ctx2 = document.getElementById('timeSpentChart').getContext('2d');
    new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: {{ time_spent_data | map(attribute='quiz_name') | list | tojson }},
            datasets: [{
                label: 'Time Spent (minutes)',
                data: {{ time_spent_data | map(attribute='time_spent') | list | tojson }},
                backgroundColor: 'rgba(54,162,235,0.5)',
                borderColor: 'rgba(54,162,235,1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Time (minutes)' },
                    ticks: { color: '#f5f5f5' }
                },
                x: {
                    title: { display: true, text: 'Quiz' },
                    ticks: { color: '#f5f5f5', maxRotation: 45, minRotation: 45 }
                }
            },
            plugins: {
                legend: { labels: { color: '#f5f5f5' } },
                tooltip: { backgroundColor: '#333', titleColor: '#fff', bodyColor: '#fff' }
            }
        }
    });

    // Difficulty Level Analysis (Grouped Bar Chart)
    var ctx3 = document.getElementById('difficultyChart').getContext('2d');
    new Chart(ctx3, {
        type: 'bar',
        data: {
            labels: {{ difficulty_order | tojson }},
            datasets: [
                {
                    label: 'Attempted',
                    data: {{ attempted_list | tojson }},
                    backgroundColor: 'rgba(255,99,132,0.5)',
                    borderColor: 'rgba(255,99,132,1)',
                    borderWidth: 1
                },
                {
                    label: 'Correct',
                    data: {{ correct_list | tojson }},
                    backgroundColor: 'rgba(75,192,192,0.5)',
                    borderColor: 'rgba(75,192,192,1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Number of Questions' },
                    ticks: { color: '#f5f5f5' }
                },
                x: {
                    title: { display: true, text: 'Difficulty' },
                    ticks: { color: '#f5f5f5' }
                }
            },
            plugins: {
                legend: { labels: { color: '#f5f5f5' } },
                tooltip: { backgroundColor: '#333', titleColor: '#fff', bodyColor: '#fff' }
            }
        }
    });
});
</script>
{% endblock %}
