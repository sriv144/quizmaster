{% extends "base.html" %}
{% block title %}Edit Question - Quiz Master{% endblock %}
{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light rounded shadow-sm mb-4">
  <div class="container-fluid">
    <ul class="navbar-nav me-auto">
      <li class="nav-item"><a class="nav-link" href="{{ url_for('app_routes.admin_dashboard') }}">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('app_routes.quiz_management') }}">Quiz</a></li>
      <li class="nav-item"><a class="nav-link" href="{{ url_for('app_routes.logout') }}">Logout</a></li>
    </ul>
  </div>
</nav>

<h2 class="mb-4 text-white">Edit Question</h2>

<form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
  <!-- Question Statement -->
  <div class="mb-3">
    <label for="question_statement" class="form-label text-white">Question Statement:</label>
    <textarea id="question_statement" name="question_statement" class="form-control" rows="3" required>{{ question.question_statement }}</textarea>
    <div class="invalid-feedback">Question statement is required.</div>
  </div>

  <!-- Question Type -->
  <div class="mb-3">
    <label for="question_type" class="form-label text-white">Question Type:</label>
    <select id="question_type" name="question_type" class="form-select" required>
      <option value="single" {% if question.question_type == 'single' %}selected{% endif %}>Single Choice</option>
      <option value="multiselect" {% if question.question_type == 'multiselect' %}selected{% endif %}>Multiple Select</option>
      <option value="integer" {% if question.question_type == 'integer' %}selected{% endif %}>Integer</option>
    </select>
  </div>

  <!-- File Upload for Image -->
  <div class="mb-3">
    <label for="image" class="form-label text-white">Upload Image (Optional):</label>
    <input type="file" class="form-control" id="image" name="image">
    {% if question.image_path %}
      <div class="mt-2">
        <p class="text-white">Current image:</p>
        <img src="{{ url_for('static', filename='uploads/' + question.image_path.split('/')[-1]) }}" alt="Question Image" style="max-width: 200px;">
      </div>
    {% endif %}
  </div>

  <!-- Options -->
  <div class="mb-3">
    <label for="option1" class="form-label text-white">Option 1:</label>
    <input type="text" class="form-control" name="option1" value="{{ question.option1 }}" required>
    <div class="invalid-feedback">Option 1 is required.</div>
  </div>
  <div class="mb-3">
    <label for="option2" class="form-label text-white">Option 2:</label>
    <input type="text" class="form-control" name="option2" value="{{ question.option2 }}" required>
    <div class="invalid-feedback">Option 2 is required.</div>
  </div>
  <div class="mb-3">
    <label for="option3" class="form-label text-white">Option 3:</label>
    <input type="text" class="form-control" name="option3" value="{{ question.option3 or '' }}">
  </div>
  <div class="mb-3">
    <label for="option4" class="form-label text-white">Option 4:</label>
    <input type="text" class="form-control" name="option4" value="{{ question.option4 or '' }}">
  </div>

  <!-- Correct Options: for single choice questions -->
  <div id="single_correct_div" class="mb-3" {% if question.question_type != 'single' %}style="display: none;"{% endif %}>
    <label class="form-label text-white">Correct Option:</label>
    <select name="correct_options" class="form-select">
      <option value="option1" {% if question.correct_option == 'option1' %}selected{% endif %}>Option 1</option>
      <option value="option2" {% if question.correct_option == 'option2' %}selected{% endif %}>Option 2</option>
      <option value="option3" {% if question.correct_option == 'option3' %}selected{% endif %}>Option 3</option>
      <option value="option4" {% if question.correct_option == 'option4' %}selected{% endif %}>Option 4</option>
    </select>
  </div>

  <!-- For multiselect questions -->
  <div id="multiselect_correct_div" class="mb-3" {% if question.question_type != 'multiselect' %}style="display: none;"{% endif %}>
    <label class="form-label text-white">Select Correct Options (check all that apply):</label>
    {% set correct_options = question.correct_option.split(',') if question.correct_option else [] %}
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option1" {% if 'option1' in correct_options %}checked{% endif %}>
      <label class="form-check-label text-white">Option 1</label>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option2" {% if 'option2' in correct_options %}checked{% endif %}>
      <label class="form-check-label text-white">Option 2</label>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option3" {% if 'option3' in correct_options %}checked{% endif %}>
      <label class="form-check-label text-white">Option 3</label>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option4" {% if 'option4' in correct_options %}checked{% endif %}>
      <label class="form-check-label text-white">Option 4</label>
    </div>
  </div>

  <!-- For integer questions -->
  <div id="integer_correct_div" class="mb-3" {% if question.question_type != 'integer' %}style="display: none;"{% endif %}>
    <label class="form-label text-white">Correct Answer (Numeric):</label>
    <input type="number" class="form-control" name="correct_options" value="{{ question.correct_option if question.question_type == 'integer' else '' }}" placeholder="Enter the correct numeric answer">
  </div>

  <!-- Marks Field -->
  <div class="mb-3">
    <label class="form-label text-white">Marks Allotted:</label>
    <input type="number" class="form-control" name="marks" value="{{ question.marks }}" min="1" required>
    <div class="invalid-feedback">Marks must be at least 1.</div>
  </div>

  <!-- Buttons -->
  <div class="d-flex gap-2">
    <button type="submit" class="btn btn-primary">Save Changes</button>
    <a href="{{ url_for('app_routes.quiz_management') }}" class="btn btn-secondary">Cancel</a>
  </div>
</form>

<script>
  // Form validation
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.needs-validation');
    
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      
      form.classList.add('was-validated');
    });
  });

  // Show/hide correct options controls based on question type selection
  const qTypeSelect = document.getElementById('question_type');
  const singleDiv = document.getElementById('single_correct_div');
  const multiDiv = document.getElementById('multiselect_correct_div');
  const integerDiv = document.getElementById('integer_correct_div');

  function updateQuestionControls() {
    const qType = qTypeSelect.value;
    if(qType === "single") {
      singleDiv.style.display = "block";
      multiDiv.style.display = "none";
      integerDiv.style.display = "none";
    } else if(qType === "multiselect") {
      singleDiv.style.display = "none";
      multiDiv.style.display = "block";
      integerDiv.style.display = "none";
    } else if(qType === "integer") {
      singleDiv.style.display = "none";
      multiDiv.style.display = "none";
      integerDiv.style.display = "block";
    }
  }
  
  qTypeSelect.addEventListener("change", updateQuestionControls);
  // Initialize display when page loads
  updateQuestionControls();
</script>
{% endblock %}
