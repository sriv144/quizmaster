{% extends "base.html" %}
{% block title %}Add Question - Quiz Master{% endblock %}

{% block content %}
<nav class="navbar navbar-expand-lg navbar-light bg-light rounded shadow-sm mb-4">
  <div class="container-fluid">
    <ul class="navbar-nav me-auto">
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('app_routes.admin_dashboard') }}">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('app_routes.quiz_management') }}">Quiz</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{{ url_for('app_routes.logout') }}">Logout</a>
      </li>
    </ul>
  </div>
</nav>

<h2 class="mb-4 text-white">Add Question to Quiz #{{ quiz.id }}: {{ quiz.name }}</h2>

<form method="POST" action="{{ url_for('app_routes.add_question', quiz_id=quiz.id) }}" enctype="multipart/form-data">
  <!-- Question Statement -->
  <div class="mb-3">
    <label for="question_statement" class="form-label text-white">Question Statement:</label>
    <textarea id="question_statement" name="question_statement" class="form-control" rows="3" required></textarea>
  </div>

  <!-- Question Type -->
  <div class="mb-3">
    <label for="question_type" class="form-label text-white">Question Type:</label>
    <select id="question_type" name="question_type" class="form-select" required>
      <option value="single">Single Choice</option>
      <option value="multiselect">Multiple Select</option>
      <option value="integer">Integer</option>
    </select>
  </div>

  <!-- File Upload for Image -->
  <div class="mb-3">
    <label for="image" class="form-label text-white">Upload Image (Optional):</label>
    <input type="file" class="form-control" id="image" name="image">
  </div>

  <!-- Options -->
  <div class="mb-3">
    <label for="option1" class="form-label text-white">Option 1:</label>
    <input type="text" class="form-control" name="option1" required>
  </div>
  <div class="mb-3">
    <label for="option2" class="form-label text-white">Option 2:</label>
    <input type="text" class="form-control" name="option2" required>
  </div>
  <div class="mb-3">
    <label for="option3" class="form-label text-white">Option 3:</label>
    <input type="text" class="form-control" name="option3">
  </div>
  <div class="mb-3">
    <label for="option4" class="form-label text-white">Option 4:</label>
    <input type="text" class="form-control" name="option4">
  </div>

  <!-- Correct Options: for single and integer questions -->
  <div id="single_correct_div" class="mb-3">
    <label class="form-label text-white">Correct Option:</label>
    <select name="correct_options" class="form-select" required>
      <option value="option1">Option 1</option>
      <option value="option2">Option 2</option>
      <option value="option3">Option 3</option>
      <option value="option4">Option 4</option>
    </select>
  </div>

  <!-- For multiselect questions -->
  <div id="multiselect_correct_div" class="mb-3" style="display: none;">
    <label class="form-label text-white">Select Correct Options (check all that apply):</label>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option1">
      <label class="form-check-label text-white">Option 1</label>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option2">
      <label class="form-check-label text-white">Option 2</label>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option3">
      <label class="form-check-label text-white">Option 3</label>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" name="correct_options" value="option4">
      <label class="form-check-label text-white">Option 4</label>
    </div>
  </div>

  <!-- For integer questions -->
  <div id="integer_correct_div" class="mb-3" style="display: none;">
    <label class="form-label text-white">Correct Answer (Numeric):</label>
    <input type="number" class="form-control" name="correct_options" placeholder="Enter the correct numeric answer" required>
  </div>

  <!-- Marks Field -->
  <div class="mb-3">
    <label class="form-label text-white">Marks Allotted:</label>
    <input type="number" class="form-control" name="marks" min="1" required>
  </div>

  <!-- Navigation Buttons -->
  <div class="d-flex justify-content-between">
    <button type="submit" name="action" value="save_next" class="btn btn-primary" formnovalidate>Save and Next</button>
    <button type="submit" name="action" value="close" class="btn btn-warning" formnovalidate>Close</button>
  </div>
  </div>
</form>

<script>
  // Show/hide correct options controls based on question type selection
  const qTypeSelect = document.getElementById('question_type');
  const singleDiv = document.getElementById('single_correct_div');
  const multiDiv = document.getElementById('multiselect_correct_div');
  const integerDiv = document.getElementById('integer_correct_div');

  function updateQuestionControls() {
    const qType = qTypeSelect.value;
    if(qType === "single") {
      singleDiv.style.display = "block";
      multiDiv.style.display = "none";
      integerDiv.style.display = "none";
    } else if(qType === "multiselect") {
      singleDiv.style.display = "none";
      multiDiv.style.display = "block";
      integerDiv.style.display = "none";
    } else if(qType === "integer") {
      singleDiv.style.display = "none";
      multiDiv.style.display = "none";
      integerDiv.style.display = "block";
    }
  }
  qTypeSelect.addEventListener("change", updateQuestionControls);
  updateQuestionControls();
</script>
{% endblock %}